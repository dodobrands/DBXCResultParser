# DBXCReportModel

The `DBXCReportModel` package provides a Swift module for parsing `.xcresult` files generated by Xcode to produce a structured report of build and test results. It allows developers to programmatically access detailed information about test cases, code coverage, and warnings from their CI/CD pipelines or automated scripts.

## Features

- Parses `.xcresult` files to create a typed model of the test results and code coverage.
- Filters out coverage data related to test helpers and test cases.
- Provides a detailed breakdown of modules, files, and repeatable tests.
- Calculates total and average test durations, as well as combined test statuses.
- Supports identifying slow tests based on average duration.
- Includes utility functions for filtering tests based on status.

## Installation

To use `DBXCReportModel` in your Swift package, add it to the dependencies for your `Package.swift` file:

```swift
let package = Package(
    name: "YourPackageName",
    dependencies: [
        .package(url: "https://github.com/dodobrands/DBXCResultParser", from: "1.0.0")
    ],
    targets: [
        .target(
            name: "YourTargetName",
            dependencies: ["DBXCResultParser"]
        )
    ]
)
```

## Usage

To parse an `.xcresult` file and access the report data, initialize a `DBXCReportModel` with the path to the `.xcresult` file:

```swift
import DBXCReportModel

let xcresultPath = URL(fileURLWithPath: "/path/to/your.xcresult")
do {
    let reportModel = try DBXCReportModel(xcresultPath: xcresultPath)
    
    // Access different parts of the report:
    let modules = reportModel.modules
    let warningCount = reportModel.warningCount
    let totalCoverage = reportModel.totalCoverage
    
    // Iterate over modules, files, and tests:
    for module in modules {
        print("Module: \(module.name)")
        for file in module.files {
            print("  File: \(file.name)")
            for repeatableTest in file.repeatableTests {
                print("    Repeatable Test: \(repeatableTest.name)")
                for test in repeatableTest.tests {
                    print("      Test: \(test.status.icon) - Duration: \(test.duration)")
                }
            }
        }
    }
    
} catch {
    print("An error occurred while parsing the .xcresult file: \(error)")
}
```

## Formatting Test Reports with DBXCTextFormatter

The `DBXCTextFormatter` class provides a way to format the data from a `DBXCReportModel` into a human-readable string. It supports two output formats: a detailed list of test results and a summary count of test results.

### Usage

To format your test report data, create an instance of `DBXCTextFormatter` with the desired output format and optionally a locale for number and measurement formatting:

```swift
import DBXCReportModel

// Assuming you have already created a `DBXCReportModel` instance as `reportModel`
let reportModel: DBXCReportModel = ...

// Create a text formatter for detailed list output
let listFormatter = DBXCTextFormatter(format: .list)

// Create a text formatter for summary count output with a specific locale
let countFormatter = DBXCTextFormatter(format: .count, locale: Locale(identifier: "en_US"))

// Format the report data into a string
let detailedListOutput = listFormatter.format(reportModel)
let summaryCountOutput = countFormatter.format(reportModel)

// Print the formatted outputs
print("Detailed List Output:\n\(detailedListOutput)")
print("Summary Count Output:\n\(summaryCountOutput)")
```

The `format` method can also take an array of `DBXCReportModel.Module.File.RepeatableTest.Test.Status` to filter which test results are included in the output. By default, it includes all test statuses.

### Output Formats

- **List Format**: Outputs a detailed list of test results, including the name of each file and the status of each test.
- **Count Format**: Outputs a summary count of test results, including the total number of tests and their combined duration.

### Example Outputs

#### List Format
```
FileA.swift
✅ TestA1
❌ TestA2

FileB.swift
✅ TestB1
⚠️ TestB2
```

#### Count Format
```
12 tests (1m 23s)
```

### Customizing Number and Measurement Formatting

The `DBXCTextFormatter` allows you to specify a locale when initializing it. This locale is used to format numbers and measurements according to the provided locale's conventions.

```swift
let formatter = DBXCTextFormatter(format: .count, locale: Locale(identifier: "fr_FR"))
let output = formatter.format(reportModel)
print(output) // Will output numbers and durations formatted in French
```

## License

This code is released under the Apache License. See [LICENSE](LICENSE) for more information.