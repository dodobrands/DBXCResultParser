# AGENTS.md

## Project Overview

DBXCResultParser is a Swift package that parses `.xcresult` files generated by Xcode to produce structured reports of build and test results. It provides programmatic access to test cases, code coverage, and warnings for CI/CD pipelines and automated scripts.

## Development Commands

### Building
```bash
swift build
```

### Testing
```bash
# Run all tests
swift test

# Run a specific test
swift test --filter <TestClassName>.<testMethodName>
```

### Running the Command-Line Tool
```bash
swift run DBXCResultParser-TextFormatterExec --xcresult-path path/to/tests.xcresult
```

Options:
- `--xcresult-path`: Path to the `.xcresult` file
- `--format`: Output format (`list` or `count`)
- `--locale`: Locale for number formatting (e.g., "en-GB")
- `--include`: Filter test results by status (e.g., `failure,skipped`)

## Architecture

### Core Components

**DBXCReportModel** (`Sources/DBXCResultParser/Models/DBXCReportModel.swift`)
- Primary data model representing parsed `.xcresult` data
- Hierarchical structure: `Module` → `File` → `RepeatableTest` → `Test`
- Each test has a status (success, failure, expectedFailure, skipped, mixed, unknown) and duration
- Provides coverage data and filtering capabilities

**DBShell** (`Sources/DBXCResultParser/DBShell.swift`)
- Executes shell commands via `/bin/zsh`
- Used internally to invoke `xcrun xcresulttool` and `xcrun xccov` for parsing `.xcresult` files

**DTO Layer** (`Sources/DBXCResultParser/Models/DTO/`)
- Data Transfer Objects that mirror the JSON structure from `xcresulttool`
- `ActionsInvocationRecordDTO`: Top-level invocation record
- `ActionTestPlanRunSummariesDTO`: Test plan summaries
- `ActionTestSummaryDTO`: Individual test summary details
- `CoverageDTO`: Code coverage data from `xccov`
- DTOs are initialized by executing `xcresulttool` commands via `DBShell` and parsing JSON output

**DBXCTextFormatter** (`Sources/DBXCResultParser-TextFormatter/DBXCTextFormatter.swift`)
- Formats `DBXCReportModel` into human-readable text
- Two output formats:
  - `list`: Detailed test results with file names and statuses
  - `count`: Summary count with total duration
- Supports locale-specific number and measurement formatting

### Package Structure

The package exports:
- **DBXCResultParser**: Core parsing library
- **DBXCResultParser-TextFormatter**: Text formatting utilities
- **DBXCResultParser-TextFormatterExec**: Executable command-line tool
- **DBXCResultParserTestHelpers**: Test helper utilities

## Testing

Test resources are stored in `Tests/DBXCResultParserTests/Resources/DBXCResultParser.xcresult` - this is a sample `.xcresult` file used for testing.
