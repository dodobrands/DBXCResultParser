# AGENTS.md

## Project Overview

DBXCResultParser is a Swift package that parses `.xcresult` files generated by Xcode to produce structured reports of build and test results. It provides programmatic access to test cases, code coverage, and warnings for CI/CD pipelines and automated scripts.

## Development Commands

### Building
```bash
swift build
```

### Testing
```bash
# Run all tests
swift test

# Run a specific test
swift test --filter <TestClassName>.<testMethodName>
```

### Running the Command-Line Tool
```bash
swift run peekie --xcresult-path path/to/tests.xcresult
```

Options:
- `--xcresult-path`: Path to the `.xcresult` file
- `--format`: Output format (`list` or `count`)
- `--locale`: Locale for number formatting (e.g., "en-GB")
- `--include`: Filter test results by status (e.g., `failure,skipped`)

## Architecture

### Core Components

**DBXCReportModel** (`Sources/DBXCResultParser/Models/DBXCReportModel.swift`)
- Primary data model representing parsed `.xcresult` data
- Hierarchical structure: `Module` → `File` → `RepeatableTest` → `Test`
- Each test has a status (success, failure, expectedFailure, skipped, mixed, unknown) and duration
- Provides coverage data and filtering capabilities

**DBShell** (`Sources/DBXCResultParser/DBShell.swift`)
- Executes shell commands via `/bin/zsh`
- Used internally to invoke `xcrun xcresulttool` and `xcrun xccov` for parsing `.xcresult` files

**DTO Layer** (`Sources/DBXCResultParser/Models/DTO/`)
- Data Transfer Objects that mirror the JSON structure from `xcresulttool`
- `TestResultsDTO`: Test results data from `xcresulttool get test-results tests`
- `CoverageDTO`: Code coverage data from `xccov`
- DTOs are initialized by executing `xcresulttool` commands via `DBShell` and parsing JSON output

**DBXCTextFormatter** (`Sources/DBXCResultParser/DBXCTextFormatter.swift`)
- Formats `DBXCReportModel` into human-readable text
- Two output formats:
  - `list`: Detailed test results with file names and statuses
  - `count`: Summary count with total duration
- Supports locale-specific number and measurement formatting

### Package Structure

The package exports:
- **DBXCResultParser**: Core parsing library (includes parsing and formatting)
- **peekie**: Executable command-line tool
- **DBXCResultParserTestHelpers**: Test helper utilities

## Testing

Test resources are stored in `Tests/DBXCResultParserTests/Resources/DBXCResultParser.xcresult` - this is a sample `.xcresult` file used for testing.

## Code Style Guidelines

### File Headers

**Never create file headers with author names or creation dates.** Files should start directly with imports or code. Do not add comments like:
- `// Created by ...`
- `// Created on ...`
- `//  FileName.swift`
- Any other header comments with author/date information

This keeps the codebase clean and avoids unnecessary maintenance overhead.

## GitHub Workflow

### Branch Management

**Never commit directly to the `main` branch.** All changes must be made in feature branches. The `main` branch should always remain synchronized with `origin/main` and should only be updated through pull requests that have been reviewed and merged.

**Always create a new branch for your changes:**
```bash
git checkout main
git fetch origin
git pull
git checkout -b your-branch-name
```

### Language Requirements

**All issues and pull requests must be written in English.** This includes titles, descriptions, and comments. This ensures consistency and accessibility for all contributors.

### Using GitHub CLI (`gh`)

All GitHub operations (creating PRs, issues, etc.) should be performed using the GitHub CLI (`gh`) tool. This ensures consistency and allows for better automation.

### Creating Pull Requests

**Always create PRs from a fresh, up-to-date main branch.** See [Branch Management](#branch-management) section above for instructions on creating a new branch.

When creating a pull request, **always use the pull request template** located at `.github/pull_request_template.md`:

```bash
gh pr create --template .github/pull_request_template.md
```

Or if you want to fill it interactively:

```bash
gh pr create --fill
```

**Important**: You must strictly follow the template structure. Do not add any additional sections beyond what is defined in the template.

The template includes sections for:
- Summary
- Key Changes
- Additional Changes

### Creating Issues

When creating issues, **always use the issue template** located at `.github/ISSUE_TEMPLATE.md`:

```bash
gh issue create --template .github/ISSUE_TEMPLATE.md
```

Or if you want to fill it interactively:

```bash
gh issue create --fill
```

**Important**: You must strictly follow the template structure. Do not add any additional sections beyond what is defined in the template.

The template includes sections for:
- Summary
- Rationale

### General GitHub CLI Usage

- Create PR: `gh pr create`
- List PRs: `gh pr list`
- View PR: `gh pr view <number>`
- Create issue: `gh issue create`
- List issues: `gh issue list`
